# 快速开始

本指南将通过一个完整的示例，帮助您快速体验 LightQuant 框架的核心功能。我们将以股票价格预测任务为例，展示从数据准备到模型训练再到回测评估的完整流程。

## 准备工作

在开始之前，请确保您已完成安装指南中的所有步骤，包括 Python 环境配置和依赖安装。此外，您需要准备以下资源：数据集文件（CSMD50 或 CSMD300），建议从项目主页下载完整数据集；已配置 GPU（推荐）或准备好在 CPU 上运行（训练速度较慢）。

### 数据集准备

首先，将下载的数据集解压到项目目录。数据集应包含价格数据和新闻数据。典型的目录结构如下：

```
dataset/
├── CSMD50/
│   ├── price/
│   │   ├── 贵州茅台.csv
│   │   ├── 工商银行.csv
│   │   └── ...
│   ├── news/
│   │   ├── 贵州茅台/
│   │   │   ├── 2021-01-01.csv
│   │   │   └── ...
│   │   └── ...
│   └── news_embedding/
│       ├── 贵州茅台/
│       │   ├── 2021-01-01.npy
│       │   └── ...
│       └── ...
```

如果您使用的是完整数据集，还需要运行数据预处理脚本生成训练集、验证集和测试集：

```bash
python utils/util.py --dataset CSMD50
```

此脚本将执行以下操作：检查并填充数据中的缺失值、生成交易日列表、划分训练集验证集和测试集、为每条数据生成标签。

### 数据预处理

在运行模型之前，需要先生成新闻文本的词向量嵌入。这需要使用 Word2Vec 模型对新闻文本进行编码：

```bash
python utils/word2vec.py \
    --dataset CSMD50 \
    --csv_news_path ./dataset/CSMD50/news/ \
    --embedding_path ./dataset/CSMD50/news_embedding/ \
    --local_model_path ./local_model/ \
    --trading_date_list ./dataset/trading_date_list.csv
```

此脚本将遍历所有新闻数据，生成对应的词向量嵌入文件，保存为 `.npy` 格式。生成嵌入文件后，数据目录结构将包含 `news_embedding` 子目录。

## 运行模型训练

LightQuant 提供了统一的训练入口脚本 `run.py`，支持通过命令行参数配置各种选项。以下是使用 HAN 模型进行多模态训练的示例命令：

```bash
python run.py \
    --dataset CSMD50 \
    --use_news True \
    --model HAN \
    --epochs 100 \
    --batch_size 64 \
    --lr 3e-4 \
    --look_back_window 7 \
    --hidden_size 128 \
    --attention_size 128 \
    --GPU_ID 0
```

### 参数说明

以下是主要参数的说明：dataset 指定使用的数据集名称，如 CSMD50 或 CSMD300；use_news 设置是否使用新闻数据，True 表示使用多模态数据，False 表示仅使用价格数据；model 指定使用的模型名称，支持 lstm、bi_lstm、alstm、adv_lstm、dtml、scinet、StockNet、HAN、PEN；epochs 设置训练的轮数；batch_size 设置批次大小；lr 设置学习率；look_back_window 设置回看窗口大小，即使用过去多少天的数据预测；hidden_size 设置模型隐藏层大小；attention_size 设置注意力机制的大小（适用于支持注意力的模型）；GPU_ID 设置使用的 GPU 编号。

### 使用单模态模型

如果您只想使用价格数据进行预测，可以设置 `--use_news False`：

```bash
python run.py \
    --dataset CSMD50 \
    --use_news False \
    --model LSTM \
    --epochs 100 \
    --batch_size 64 \
    --lr 3e-4 \
    --look_back_window 7 \
    --hidden_size 128 \
    --GPU_ID 0
```

### 使用其他模型

项目支持多种模型，您可以通过修改 `--model` 参数选择不同的模型。不同模型的特定参数说明如下：

对于 LSTM 和 BiLSTM 模型，主要参数包括 input_size（输入特征数，默认 5）、hidden_size（隐藏层大小）、layers（LSTM 层数）和 dropout（Dropout 比率）。对于 ALSTM 模型，在 LSTM 基础上增加了 attention_size 参数用于注意力机制。对于 Adv-LSTM 模型，需要设置 epsilon（对抗训练参数）和 perturbation_size（扰动大小）。对于 DTML 模型，需要设置 n_stocks（每次训练的股票数量）。对于 SCINet 模型，需要设置 seq_len（输入序列长度）和 pred_len（预测长度）。对于 StockNet 和 HAN 模型，需要设置 BERT 相关的参数如 pretrained_model（预训练模型路径）。

## 监控训练过程

LightQuant 使用 SwanLab 进行实验跟踪和可视化。训练过程中，您可以在 SwanLab 控制台查看实时的训练指标，包括损失值、准确率等。默认配置使用项目提供的 API key，如需使用自己的账户，请在 `run.py` 中修改 swanlab_api、swanlab_project 和 swanlab_workspace 参数。

训练过程中会输出以下信息：当前轮次和进度、训练损失和验证损失、当前学习率、已用时间和预计剩余时间、模型保存提示。

### 模型保存

训练完成后，模型会自动保存到指定目录。默认保存路径为 `./result/{dataset}/model_saved/{model}.pth`。您可以使用此保存的模型进行后续的预测和回测。

## 运行回测

模型训练完成后，可以使用回测功能验证策略的有效性。首先需要准备回测数据，然后运行回测脚本：

```bash
python backtest/run_backtest.py \
    --dataset CSMD50 \
    --model HAN \
    --use_news False \
    --look_back_window 7 \
    --model_save_folder ./result/CSMD50/model_saved/ \
    --test_price_folder ./dataset/CSMD50/test/price/ \
    --backtest_result_folder ./result/CSMD50/backtest_result/
```

### 回测结果解读

回测完成后，结果将保存在指定目录。典型的输出指标包括：ACC（准确率）表示预测正确的比例；ARR（年化收益率）表示策略的年化收益能力；SR（夏普比率）表示风险调整后的收益；MDD（最大回撤）表示策略可能面临的最大亏损幅度；CR（Calmar 比率）表示年化收益率与最大回撤的比值；IR（信息比率）表示策略相对于基准的超额收益。

结果文件包括：数值指标文件（.txt）包含各项指标的汇总值；累计收益率曲线（.csv）包含每日的累计收益率数据，可用于绘制收益曲线。

### 可视化结果

项目提供了绘图工具用于可视化回测结果。您可以运行以下命令生成收益曲线图：

```bash
python utils/plot.py \
    --result_file ./result/CSMD50/backtest_result/HAN_cumulative_return.csv \
    --output_file ./result/CSMD50/backtest_result/figure/
```

此命令将生成累计收益率曲线图，帮助您直观了解策略的收益表现。

## 完整工作流程总结

以下是使用 LightQuant 的完整工作流程总结：

第一步是环境准备，完成 Python 环境配置和依赖安装。第二步是数据集准备，下载并解压数据集到正确目录。第三步是数据预处理，运行 `python utils/util.py --dataset CSMD50` 进行数据清洗和划分。第四步是生成词向量嵌入，运行 `python utils/word2vec.py` 生成新闻嵌入。第五步是模型训练，运行 `python run.py` 训练选定的模型。第六步是回测评估，运行 `python backtest/run_backtest.py` 评估策略效果。第七步是结果分析，查看结果文件并使用绘图工具可视化。

## 常见问题

如果在运行过程中遇到问题，请参考以下建议：如果提示缺少模块，请检查是否正确安装所有依赖；如果 GPU 不可用，请检查 CUDA 配置或设置 `--useGPU False`；如果内存不足，请减小 batch_size 或使用支持梯度累积的配置；如果结果异常，请检查数据是否正确加载和预处理。

## 下一步

完成快速开始后，您可以：阅读用户指南深入了解各模块的详细功能；尝试不同的模型配置，探索最优参数；参考教程文档学习更高级的使用方法；查阅 API 参考了解可用的编程接口；如需进行二次开发，请阅读开发者指南。

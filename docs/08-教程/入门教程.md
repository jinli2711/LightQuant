# 入门教程

本教程将通过一个完整的示例，帮助 LightQuant 新用户快速上手。我们将以 CSMD50 数据集为基础，使用 LSTM 模型进行股票涨跌预测，完成从环境准备到回测评估的完整流程。

## 准备工作

### 环境检查

首先，确认您的开发环境满足要求。打开终端，执行以下命令验证 Python 和 pip 安装：`python --version` 和 `pip --version`。如果命令输出 Python 版本号且大于等于 3.8，说明 Python 环境正常。

接下来，检查项目依赖是否已安装。进入项目目录，执行：`pip list | grep -E "torch|pandas|numpy|sklearn"`。如果输出中包含 torch、pandas、numpy、scikit-learn 等包，说明核心依赖已安装。

最后，验证 GPU 环境（如有）：`python -c "import torch; print(f'CUDA: {torch.cuda.is_available()}')"`。如果输出 CUDA: True，表示 GPU 环境正常。

### 数据准备

从项目主页下载 CSMD50 数据集压缩包。解压后，将数据集文件夹（包含 price、news 等子文件夹）放置在项目根目录下的 dataset/ 文件夹中。最终的目录结构应如下：dataset/CSMD50/price/ 包含各股票的 CSV 价格文件；dataset/CSMD50/news/ 包含按股票分组的新闻文件。

如果您下载的是完整数据集，还需要运行数据预处理脚本生成训练集、验证集和测试集划分。在项目根目录执行：`python utils/util.py --dataset CSMD50`。此命令会自动检查缺失值、划分数据集并生成标签。

## 第一步：运行预处理

### 执行数据预处理

在终端中执行以下命令：`python utils/util.py --dataset CSMD50`。

您将看到类似以下输出：正在检查缺失值；正在填补缺失值；正在划分数据集；正在生成标签；处理完成。

预处理完成后，检查 dataset/CSMD50/ 目录下是否自动创建了 train/、val/、test/ 子目录，每个子目录下包含 price/ 子目录。确认划分成功后再进行下一步。

### 生成词向量嵌入

如果使用多模态模型（如 HAN、StockNet），需要生成新闻的词向量嵌入。执行以下命令：`python utils/word2vec.py --dataset CSMD50 --csv_news_path ./dataset/CSMD50/news/ --embedding_path ./dataset/CSMD50/news_embedding/`。此过程可能需要较长时间，取决于您的数据量和 GPU 性能。

生成完成后，检查 dataset/CSMD50/ 目录下是否创建了 news_embedding/ 子目录，其中应包含按股票和日期组织的 .npy 文件。

## 第二步：训练模型

### 运行单模态训练

我们将使用 LSTM 模型进行单模态训练（仅使用价格数据）。在终端中执行以下命令：`python run.py --dataset CSMD50 --use_news False --model lstm --epochs 50 --batch_size 64 --lr 3e-4 --look_back_window 7 --hidden_size 128 --GPU_ID 0`。

训练过程中会输出以下信息：当前 epoch 进度和已用时间；训练损失和验证损失；学习率信息；预计剩余时间；SwanLab 实验链接。

训练完成后，检查 ./result/CSMD50/model_saved/ 目录下是否生成了 lstm.pth 文件。这包含了训练好的模型权重。

### 训练参数说明

以下是本次训练使用的主要参数说明：--dataset CSMD50 指定使用 CSMD50 数据集；--use_news False 表示不使用新闻数据，仅用价格数据训练；--model lstm 指定使用 LSTM 模型；--epochs 50 设置训练 50 轮；--batch_size 64 设置每批 64 个样本；--lr 3e-4 设置学习率为 0.0003；--look_back_window 7 设置使用过去 7 天数据预测；--hidden_size 128 设置 LSTM 隐藏层大小为 128；--GPU_ID 0 指定使用第一个 GPU。

## 第三步：评估模型

### 运行评估

模型训练完成后，使用评估脚本测试模型性能。执行以下命令：`python eval_single.py --dataset CSMD50 --model lstm --model_path ./result/CSMD50/model_saved/lstm.pth --test_price_folder ./dataset/CSMD50/test/price/`。

评估完成后会输出测试集上的准确率（ACC）和 MCC 值。记录这些数值用于后续比较。

### 尝试其他模型

作为对比，您可以训练其他模型。例如，使用 BiLSTM：`python run.py --dataset CSMD50 --use_news False --model bi_lstm --epochs 50 --batch_size 64 --lr 3e-4 --look_back_window 7 --hidden_size 128 --GPU_ID 0`。

然后评估 BiLSTM：`python eval_single.py --dataset CSMD50 --model bi_lstm --model_path ./result/CSMD50/model_saved/bi_lstm.pth --test_price_folder ./dataset/CSMD50/test/price/`。

比较两个模型的评估结果，观察哪个模型效果更好。

## 第四步：回测评估

### 运行回测

使用回测脚本评估策略在历史数据上的模拟收益。执行以下命令：`python backtest/run_backtest.py --dataset CSMD50 --model lstm --use_news False --look_back_window 7 --model_save_folder ./result/CSMD50/model_saved/ --test_price_folder ./dataset/CSMD50/test/price/ --backtest_result_folder ./result/CSMD50/backtest_result/`。

回测完成后会输出各项指标的平均值，包括：mean ACC（准确率）；mean ARR（年化收益率）；mean SR（夏普比率）；mean MDD（最大回撤）；mean CR（Calmar 比率）；mean IR（信息比率）。

### 查看回测结果

回测结果保存在 --backtest_result_folder 指定的目录。打开 ./result/CSMD50/backtest_result/lstm.txt 查看详细指标。查看 ./result/CSMD50/backtest_result/lstm_cumulative_return.csv 获取每日累计收益率数据。

## 第五步：可视化结果

### 绘制收益曲线

使用绘图工具可视化回测结果。执行以下命令：`python utils/plot.py --result_file ./result/CSMD50/backtest_result/lstm_cumulative_return.csv --output_file ./result/CSMD50/backtest_result/lstm_return_curve.png`。

命令执行后会在指定目录生成收益曲线图。图片展示了策略资产净值随时间的变化，可以直观观察策略的收益表现和回撤情况。

### 多模型对比

要比较不同模型，可以对多个模型分别运行回测，然后使用对比绘图功能。修改绘图脚本或手动比较生成的指标文件。

## 结果解读

### 评估指标解读

ACC（准确率）衡量预测正确的比例，基准约为 50%（随机猜测）。ACC 达到 53-55% 表示模型有一定的预测能力。ARR（年化收益率）表示策略的年化收益能力，正值表示盈利，负值表示亏损。SR（夏普比率）衡量风险调整后收益，SR > 1 表示风险调整后收益良好。MDD（最大回撤）表示策略在最坏情况下的最大跌幅，MDD 越小越好。

### 常见结果模式

如果 ACC 接近 50%：模型预测能力较弱，可能需要更复杂的模型或更好的特征工程。如果 ARR 为负：策略在历史上是亏损的，不建议实盘使用。如果 SR < 0：策略表现不如无风险资产。如果 MDD 过大：策略风险较高，需要谨慎考虑。

## 进阶学习建议

### 下一步学习

完成本教程后，建议继续学习：尝试多模态模型（如 HAN），比较单模态和多模态的效果差异；调整超参数（如学习率、批量大小、隐藏层大小），观察对结果的影响；尝试不同的回看窗口，找到适合的设置；学习模型评估和参数调优的更多技巧。

### 学习资源

建议阅读以下文档深入学习：用户指南中的模型训练章节了解详细参数配置；用户指南中的策略回测章节了解回测细节；API 参考文档了解各模块的详细接口；模型文档了解各模型的原理和特点。

### 实验建议

进行实验时建议：记录每次实验的配置和结果，便于比较和复现；保持控制变量，一次只改变一个参数；从简单模型开始，逐步增加复杂度；使用验证集进行参数选择，避免在测试集上过度调优。
